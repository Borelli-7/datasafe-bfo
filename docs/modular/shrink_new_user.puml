@startuml

skinparam SequenceMessageAlign center

activate DocusafeServiceAdapterTest
' de.adorsys.datasafe.business.impl.impl.DocusafeServiceAdapterTest
DocusafeServiceAdapterTest -> DocusafeServiceAdapterImpl : createUser

activate DocusafeServiceAdapterImpl
' de.adorsys.datasafe.business.impl.service.DocusafeServiceAdapterImpl
DocusafeServiceAdapterImpl -> DefaultDocusafeServices : userProfile

activate DefaultDocusafeServices
' de.adorsys.datasafe.business.impl.service.DefaultDocusafeServices
DefaultDocusafeServices -> DaggerDefaultDocusafeServices : userProfile

activate DaggerDefaultDocusafeServices
' de.adorsys.datasafe.business.impl.service.DaggerDefaultDocusafeServices
DefaultDocusafeServices <-- DaggerDefaultDocusafeServices : DFSBasedProfileStorageImpl
deactivate DaggerDefaultDocusafeServices

' de.adorsys.datasafe.business.impl.service.DefaultDocusafeServices
DocusafeServiceAdapterImpl <-- DefaultDocusafeServices : DFSBasedProfileStorageImpl
deactivate DefaultDocusafeServices

' de.adorsys.datasafe.business.impl.service.DocusafeServiceAdapterImpl
DocusafeServiceAdapterImpl -> Profile : registerPublic

activate DFSBasedProfileStorageImpl
' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> Profile : systemDfs

activate DFSSystem
' de.adorsys.datasafe.business.impl.profile.DFSSystem
Profile <-- Profile : DFSAccess
deactivate DFSSystem

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> DFS : obtain

activate DFSConnectionService
' de.adorsys.datasafe.business.api.deployment.dfs.DFSConnectionService
DFS -> DFS : obtain

activate DFSConnectionServiceImpl
' de.adorsys.datasafe.business.impl.dfs.DFSConnectionServiceImpl
DFS <-- DFS : DFSConnection
deactivate DFSConnectionServiceImpl

' de.adorsys.datasafe.business.api.deployment.dfs.DFSConnectionService
Profile <-- DFS : DFSConnection
deactivate DFSConnectionService

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> Profile : locatePublicProfile

activate DFSBasedProfileStorageImpl
' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile <-- Profile : BucketPath
deactivate DFSBasedProfileStorageImpl

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> DFSConnection : createContainer

activate DFSConnection
' de.adorsys.dfs.connection.api.service.api.DFSConnection
Profile <-- DFSConnection :
deactivate DFSConnection

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> SERDE : toJson

activate GsonSerde
' de.adorsys.datasafe.business.impl.serde.GsonSerde
Profile <-- SERDE : String
deactivate GsonSerde

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> DFSConnection : putBlob

activate DFSConnection
' de.adorsys.dfs.connection.api.service.api.DFSConnection
Profile <-- DFSConnection :
deactivate DFSConnection

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
DocusafeServiceAdapterImpl <-- Profile :
deactivate DFSBasedProfileStorageImpl

' de.adorsys.datasafe.business.impl.service.DocusafeServiceAdapterImpl
DocusafeServiceAdapterImpl -> DefaultDocusafeServices : userProfile

activate DefaultDocusafeServices
' de.adorsys.datasafe.business.impl.service.DefaultDocusafeServices
DefaultDocusafeServices -> DaggerDefaultDocusafeServices : userProfile

activate DaggerDefaultDocusafeServices
' de.adorsys.datasafe.business.impl.service.DaggerDefaultDocusafeServices
DefaultDocusafeServices <-- DaggerDefaultDocusafeServices : DFSBasedProfileStorageImpl
deactivate DaggerDefaultDocusafeServices

' de.adorsys.datasafe.business.impl.service.DefaultDocusafeServices
DocusafeServiceAdapterImpl <-- DefaultDocusafeServices : DFSBasedProfileStorageImpl
deactivate DefaultDocusafeServices

' de.adorsys.datasafe.business.impl.service.DocusafeServiceAdapterImpl
DocusafeServiceAdapterImpl -> Profile : registerPrivate

activate DFSBasedProfileStorageImpl
' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> Profile : systemDfs

activate DFSSystem
' de.adorsys.datasafe.business.impl.profile.DFSSystem
Profile <-- Profile : DFSAccess
deactivate DFSSystem

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> DFS : obtain

activate DFSConnectionService
' de.adorsys.datasafe.business.api.deployment.dfs.DFSConnectionService
DFS -> DFS : obtain

activate DFSConnectionServiceImpl
' de.adorsys.datasafe.business.impl.dfs.DFSConnectionServiceImpl
DFS <-- DFS : DFSConnection
deactivate DFSConnectionServiceImpl

' de.adorsys.datasafe.business.api.deployment.dfs.DFSConnectionService
Profile <-- DFS : DFSConnection
deactivate DFSConnectionService

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> Profile : locatePrivateProfile

activate DFSBasedProfileStorageImpl
' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile <-- Profile : BucketPath
deactivate DFSBasedProfileStorageImpl

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> DFSConnection : createContainer

activate DFSConnection
' de.adorsys.dfs.connection.api.service.api.DFSConnection
Profile <-- DFSConnection :
deactivate DFSConnection

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> SERDE : toJson

activate GsonSerde
' de.adorsys.datasafe.business.impl.serde.GsonSerde
Profile <-- SERDE : String
deactivate GsonSerde

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> DFSConnection : putBlob

activate DFSConnection
' de.adorsys.dfs.connection.api.service.api.DFSConnection
Profile <-- DFSConnection :
deactivate DFSConnection

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> Profile : createKeyStore

activate DFSBasedProfileStorageImpl
' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> Profile : privateKeyStoreAuth

activate DFSSystem
' de.adorsys.datasafe.business.impl.profile.DFSSystem
Profile <-- Profile : KeyStoreAuth
deactivate DFSSystem

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> KeyStoreService : createKeyStore

activate KeyStoreService
' de.adorsys.datasafe.business.api.deployment.keystore.KeyStoreService
Profile <-- KeyStoreService : KeyStore
deactivate KeyStoreService

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> DFS : obtain

activate DFSConnectionService
' de.adorsys.datasafe.business.api.deployment.dfs.DFSConnectionService
DFS -> DFS : obtain

activate DFSConnectionServiceImpl
' de.adorsys.datasafe.business.impl.dfs.DFSConnectionServiceImpl
DFS <-- DFS : DFSConnection
deactivate DFSConnectionServiceImpl

' de.adorsys.datasafe.business.api.deployment.dfs.DFSConnectionService
Profile <-- DFS : DFSConnection
deactivate DFSConnectionService

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> DFSConnection : createContainer

activate DFSConnection
' de.adorsys.dfs.connection.api.service.api.DFSConnection
Profile <-- DFSConnection :
deactivate DFSConnection

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile -> DFSConnection : putBlob

activate DFSConnection
' de.adorsys.dfs.connection.api.service.api.DFSConnection
Profile <-- DFSConnection :
deactivate DFSConnection

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
Profile <-- Profile :
deactivate DFSBasedProfileStorageImpl

' de.adorsys.datasafe.business.impl.profile.DFSBasedProfileStorageImpl
DocusafeServiceAdapterImpl <-- Profile :
deactivate DFSBasedProfileStorageImpl

' de.adorsys.datasafe.business.impl.service.DocusafeServiceAdapterImpl
DocusafeServiceAdapterTest <-- DocusafeServiceAdapterImpl :
deactivate DocusafeServiceAdapterImpl

@enduml